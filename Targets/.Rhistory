fire2021<-read_html("https://www.fire.ca.gov/incidents/2021/")
rary(rvest)
library(tidyjson)
library(jsonlite)
fire2021<-read_html("https://www.fire.ca.gov/incidents/2021/")
library(rvest)
library(tidyjson)
library(jsonlite)
fire2021<-read_html("https://www.fire.ca.gov/incidents/2021/")
tablefind<-fire2021 %>% html_nodes('body') %>%
xml_find_all("//div[contains(@id, 'incidentListTable')]") %>%
html_children()
tablefind[2]
tablefind[2] %>% html_text
cleanlist<-tablefind[2] %>% html_text
library(tidyverse)
cleanlist<-cleanlist %>% str_replace(".* = ", "") %>% str_replace("\r\n","")
cleanlist<-gsub(";\r\n.*","",cleanlist)
print(cleanlist)
json_cleanlist<-tojson(cleanlist)
json_cleanlist<-toJSON(cleanlist)
tibble_cleanlist<-fromJSON(json_cleanlist)
view(tibble_cleanlist)
class(json_cleanlist)
json_cleanlist %>% spread_all()
cleanlist %>% spread_all
cleanlist %>% spread_all()
print(cleanlist)
class(cleanlist)<-"json"
json_cleanlist<-fromJSON(cleanlist)
View(json_cleanlist)
print(cleanlist)
class(fire2021)
class(cleanlist)
class(tablefind)
View(tablefind)
class(json_cleanlist)
mean(json_cleanlist$AcresBurned)
mean(json_cleanlist$AcresBurnedl,na.rm=T)
json_cleanlist$AcresBurned<-as.numeric(json_cleanlist$AcresBurned)
mean(json_cleanlist$AcresBurned)
mean(json_cleanlist$AcresBurned,na.rm=T)
class(json_cleanlist$AcresBurned)
class(json_cleanlist$UniqueId)
class(json_cleanlist$Name)
source("functions.R")
library(targets)
source("functions.R")
library(targets)
source("functions.R")
g
g
library(targets)
source("~/Dropbox/california-fire-tracking/Targets/functions.R")
source("functions.R")
library(targets)
source("/functions.R")
source("functions.R")
library(targets)
source("~/Dropbox/california-fire-tracking/Targets/functions.R")
source("~/functions.R")
source("../functions.R")
source("~/california-fire-tracking/Targets/functions.R")
source("~/Targets/functions.R")
source("/Targets/functions.R")
source("functions.R")
getwd()
getwd()
library(targets)
source("functions.R")
source("functions.R")
library(targets)
source("functions.R")
source("~/Dropbox/california-fire-tracking/Targets/functions.R")
library(targets)
source("functions.R")
source("functions.R",local = T)
library(targets)
setwd(dirname(getwd()))
source("functions.R")
source("functions.R")
library(targets)
setwd(dirname(getwd()))
source("functions.R")
getwd()
getwd()
getwd()
getwd()
setwd("~/Dropbox/california-fire-tracking/Targets")
setwd("~/Dropbox/california-fire-tracking/Targets")
library(targets)
source("functions.R")
library(targets)
setwd("~/california-fire-tracking/Targets")
setwd("~/Dropbox/california-fire-tracking/Targets")
source("functions.R")
setwd("~/Dropbox/california-fire-tracking/Targets")
setwd("~/Dropbox/california-fire-tracking/Targets")
library(targets)
source("functions.R")
library(targets)
source("functions.R")
library(targets)
source("functions.R")
sprintf("https://www.fire.ca.gov/incidents/%i",2021)
print(sprintf("https://www.fire.ca.gov/incidents/%i",2021))
print(sprintf("https://www.fire.ca.gov/incidents/%i/",2021))
years<-c(2000:2020)
print(sprintf("https://www.fire.ca.gov/incidents/%i/",years))
length(sprintf("https://www.fire.ca.gov/incidents/%i/",years))
years<-c(2000:2020)
url<-(sprintf("https://www.fire.ca.gov/incidents/%i/",years))
fire_html_list<-xml2::read_html(url)
html_object<-purrr::map(url,xml2::read_html()
)
years<-c(2000:2020)
url<-(sprintf("https://www.fire.ca.gov/incidents/%i/",years))
print(url)
map(url,read_html())
html_object<-purrr::map(url,xml2::read_html()
) %>% bind_rows()
html_object<-lapply(url,xml2::read_html()
) %>% bind_rows()
read_html(url[2])
lapply(url,read_html())
lapply(url,read_html(url))
lapply(url,read_html)
html_object<-lapply(url,read_html)
#fireurl = "https://www.fire.ca.gov/incidents/2021/")
#years = c(2018:2021) for example
print(c(2018:2021))
library(xml2)
library(tidyverse)
?fromJSON
library(targets)
source("functions.R")
json_list<-lapply(html_object, function(html_reading){
tablefinder<-html_reading %>%
html_nodes('body') %>%
xml_find_all("//div[contains(@id, 'incidentListTable')]") %>%
html_children()
jsonstring<-tablefinder[2] %>% html_text
jsonstring<-jsonstring %>% str_replace(".* = ", "") %>% str_replace("\r\n","")
jsonstring<-gsub(";\r\n.*","",jsonstring)
class(jsonstring)<-"json"
})
print(json_list[2])
json_list<-lapply(html_object, function(html_reading){
tablefinder<-html_reading %>%
html_nodes('body') %>%
xml_find_all("//div[contains(@id, 'incidentListTable')]") %>%
html_children()
jsonstring<-tablefinder[2] %>% html_text()
jsonstring<-jsonstring %>% str_replace(".* = ", "") %>% str_replace("\r\n","")
jsonstring<-gsub(";\r\n.*","",jsonstring)
class(jsonstring)<-"json"
})
#fireurl = "https://www.fire.ca.gov/incidents/2021/")
years = c(2018:2021) for example
url_list<-(sprintf("https://www.fire.ca.gov/incidents/%i/",years))
#fireurl = "https://www.fire.ca.gov/incidents/2021/")
years = c(2018:2021)
#fireurl = "https://www.fire.ca.gov/incidents/2021/")
years = c(2018:2021)
url_list<-(sprintf("https://www.fire.ca.gov/incidents/%i/",years))
html_object<-lapply(url_list,read_html)
json_list<-lapply(html_object, function(html_reading){
tablefinder<-html_reading %>% html_nodes('body') %>%
xml_find_all("//div[contains(@id, 'incidentListTable')]") %>%
html_children()
jsonstring<-tablefinder[2] %>% html_text()
jsonstring<-jsonstring %>% str_replace(".* = ", "") %>% str_replace("\r\n","")
jsonstring<-gsub(";\r\n.*","",jsonstring)
class(jsonstring)<-"json"
})
fire2021<-read_html("https://www.fire.ca.gov/incidents/2021/")
tablefind<-fire2021 %>%
html_nodes('body') %>%
xml_find_all("//div[contains(@id, 'incidentListTable')]") %>%
html_children()
cleanlist<-tablefind[2] %>% html_text
cleanlist<-cleanlist %>% str_replace(".* = ", "") %>% str_replace("\r\n","")
cleanlist<-gsub(";\r\n.*","",cleanlist)
print(cleanlist)
class(cleanlist)<-"json"
json_cleanlist<-fromJSON(cleanlist)
class(json_cleanlist)
view(json_cleanlist)
html_reading<-html_object[1]
tablefinder<-html_reading %>% html_nodes('body') %>%
xml_find_all("//div[contains(@id, 'incidentListTable')]") %>%
html_children()
class(fire2021)
json_list<-lapply(html_object, function(html_reading){
class(html_reading)<-c("xml_document" , "xml_node")
tablefinder<-html_reading %>% html_nodes('body') %>%
xml_find_all("//div[contains(@id, 'incidentListTable')]") %>%
html_children()
jsonstring<-tablefinder[2] %>% html_text()
jsonstring<-jsonstring %>% str_replace(".* = ", "") %>% str_replace("\r\n","")
jsonstring<-gsub(";\r\n.*","",jsonstring)
class(jsonstring)<-"json"
})
#fireurl = "https://www.fire.ca.gov/incidents/2021/")
years = c(2018:2021)
url_list<-(sprintf("https://www.fire.ca.gov/incidents/%i/",years))
html_object<-lapply(url_list,read_html)
json_list<-lapply(html_object, function(html_reading){
class(html_reading)<-c("xml_document" , "xml_node")
tablefinder<-html_reading %>% html_nodes('body') %>%
xml_find_all("//div[contains(@id, 'incidentListTable')]") %>%
html_children()
jsonstring<-tablefinder[2] %>% html_text()
jsonstring<-jsonstring %>% str_replace(".* = ", "") %>% str_replace("\r\n","")
jsonstring<-gsub(";\r\n.*","",jsonstring)
class(jsonstring)<-"json"
})
class(fire2021)
html_object <- lapply(html_object,function(x){
class(x)<-("xml_document", "xml_node")
})
class(html_object)
html_object <- lapply(html_object,function(x){
class(x)<-c("xml_document", "xml_node")
})
class(html_object)
class(html_object[1])
class(fire2021)
class(html_object[[1]])
html_object <- lapply(html_object,function(x){
class(x)<-c("xml_document", "xml_node")
return(x)
})
class(html_object[[1]])
class(html_object[1])
json_list<-lapply(html_object, function(html_reading){
tablefinder<-html_reading %>% html_nodes('body') %>%
xml_find_all("//div[contains(@id, 'incidentListTable')]") %>%
html_children()
jsonstring<-tablefinder[2] %>% html_text()
jsonstring<-jsonstring %>% str_replace(".* = ", "") %>% str_replace("\r\n","")
jsonstring<-gsub(";\r\n.*","",jsonstring)
class(jsonstring)<-"json"
})
#fireurl = "https://www.fire.ca.gov/incidents/2021/")
years = c(2018:2021)
url_list<-(sprintf("https://www.fire.ca.gov/incidents/%i/",years))
html_object<-lapply(url_list,read_html)
fire2021<-read_html("https://www.fire.ca.gov/incidents/2021/")
json_list<-lapply(html_object, function(html_reading){
tablefinder<-html_reading %>% html_nodes('body') %>%
xml_find_all("//div[contains(@id, 'incidentListTable')]") %>%
html_children()
jsonstring<-tablefinder[2] %>% html_text()
jsonstring<-jsonstring %>% str_replace(".* = ", "") %>% str_replace("\r\n","")
jsonstring<-gsub(";\r\n.*","",jsonstring)
class(jsonstring)<-"json"
return(jsonstring)
})
class(json_list[1])
class(json_list)
class(json_list[[1]])
data_tables<-lapply(json_list,fromJSON)
view(data_tables[1])
view(data_tables[2])
library(targets)
source("functions.R")
view(data_tables[1])
years<-(2010:2020)
years[[2011]]
years[2011]
years[2]
length(years)
years[[1]]
ibrary(targets)
source("functions.R")
options(tidyverse.quiet = TRUE)
library(targets)
source("functions.R")
options(tidyverse.quiet = TRUE)
list(
tar_target(
fire_url,
command = "https://www.fire.ca.gov/incidents/",
format = "url"
),
tar_target(
years,
command = c(2010:2020)
),
tar_target(
clean_data,
scrape_clean_fire_data(fire_url,years)
),
tar_target(
write_csv_files,
command = for(i in length(years)){
write_csv(clean_data[[i]],file = sprintf("../Data/fire_track_%i.csv",years[[i]]))
}
)
)
tar_visnetwork()
getwd()
tar_make()
tar_make()
tar_visnetwork()
tar_make()
?html_children
tar_make()
data_tables[1] %>% unnest(Counties)
data_tables[1] %>% unlist(Counties)
colnames(data_tables[1])
colnames(data_tables[1])
data_tables[1] %>% mutate(Counties = map_chr(Counties, toString))
data_tables[1] %>% unnest(Counties)
data_tables[1] %>% unnest(Countiess)
data_tables[1] %>% unnest(Countiesss)
example_csv<-data_tables[1]
example_csv<-tibble(example_csv)
View(example_csv)
View(example_csv[[1]][[1]])
example_csv<-data_tables[1]
class(example_csv)
as.data.frame(example_csv)
example_csv<-as.data.frame(example_csv)
colnames(example_csv)
example_csv<- example_csv %>% unnest(Counties)
write_csv(example_csv,"../Data/fire_track_2018.csv")
getwd()
tar_make()
print(c(2018:2020))
tar_visnetwork()
tar_make()
tar_make()
tar_make()
tar_read(clean_data)
tar_make()
years<-c(2019:2021)
length(years)
tar_make()
